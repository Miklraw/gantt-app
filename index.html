<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gantt ULTRA PRO</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <h1>üîê –í—Ö–æ–¥</h1>
            <p>–í–≤–µ–¥–∏—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</p>
            <div class="login-form">
                <div>
                    <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" id="loginUsername" placeholder="admin" autocomplete="username">
                </div>
                <div>
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="loginPassword" placeholder="admin123" autocomplete="current-password">
                </div>
                <div id="loginError" class="login-error">–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
                <button id="loginBtn" class="login-btn">–í–æ–π—Ç–∏</button>
            </div>
            <div class="login-hint">
                <strong>–¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã:</strong><br>
                admin / admin123<br>
                manager / manager123
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="wrap" id="mainApp" style="display:none;">
        <!-- Header -->
        <header>
            <div>
                <h1 id="projectTitle">üöÄ Gantt ULTRA PRO</h1>
                <div class="note">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–æ—É-–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è–º–∏</div>
            </div>
            <div class="header-actions">
                <div class="history-controls">
                    <button id="undoBtn" class="btn secondary" title="–û—Ç–º–µ–Ω–∏—Ç—å (Ctrl+Z)" disabled>‚Ü∂</button>
                    <button id="redoBtn" class="btn secondary" title="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å (Ctrl+Y)" disabled>‚Ü∑</button>
                </div>
                <div class="tabs">
                    <button class="tab-btn active" data-tab="table">üìä –¢–∞–±–ª–∏—Ü–∞</button>
                    <button class="tab-btn" data-tab="gantt">üìà –î–∏–∞–≥—Ä–∞–º–º–∞</button>
                    <button class="tab-btn" data-tab="broadcast">üîî –†–∞—Å—Å—ã–ª–∫–∞</button>
                    <button class="tab-btn" data-tab="settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                </div>
                <button id="themeToggleBtn" class="btn secondary" title="–¢–µ–º–∞">üåô</button>
                <button id="logoutBtn" class="btn secondary">üö™ –í—ã—Ö–æ–¥</button>
            </div>
        </header>

        <!-- Table Tab -->
        <section id="tab-table" class="card">
            <!-- Toolbar -->
            <div class="row toolbar">
                <button id="addRowBtn" class="btn">+ –†–∞–±–æ—Ç–∞</button>
                <button id="addMilestoneBtn" class="btn secondary">‚óá –í–µ—Ö–∞</button>
                <button id="duplicateBtn" class="btn ghost">üìã –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å</button>
                <button id="shareBtn" class="btn share-btn">üîó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                <button id="saveBtn" class="btn save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <div class="spacer"></div>
                <button id="exportExcelBtn" class="btn ghost excel-btn">üìä Excel</button>
                <button id="exportPdfBtn" class="btn ghost pdf-btn">üìÑ PDF</button>
                <button id="refreshBtn" class="btn ghost refresh-btn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>

            <!-- Filters -->
            <div class="search-filter">
                <input type="text" id="searchInput" placeholder="üîç –ü–æ–∏—Å–∫...">
                <select id="filterType"><option value="">–í—Å–µ —Ç–∏–ø—ã</option></select>
                <select id="filterPriority">
                    <option value="">–í—Å–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã</option>
                    <option value="high">üî¥ –í—ã—Å–æ–∫–∏–π</option>
                    <option value="medium">üü° –°—Ä–µ–¥–Ω–∏–π</option>
                    <option value="low">üîµ –ù–∏–∑–∫–∏–π</option>
                </select>
                <button id="clearFiltersBtn" class="btn ghost">–°–±—Ä–æ—Å–∏—Ç—å</button>
                <span class="note" id="filteredCount">0 / 0</span>
            </div>

            <!-- Table -->
            <div class="table-container">
                <table id="taskTable" class="table-modern">
                    <thead>
                        <tr>
                            <th style="width:40px">#</th>
                            <th data-sort="type" style="width:120px">–¢–∏–ø</th>
                            <th data-sort="task" style="width:200px">–†–∞–±–æ—Ç–∞</th>
                            <th data-sort="start" style="width:140px">–ù–∞—á–∞–ª–æ</th>
                            <th data-sort="end" style="width:140px">–ö–æ–Ω–µ—Ü</th>
                            <th id="progressHeader" class="progress-col" style="width:100px;display:none">–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
                            <th id="priorityHeader" class="priority-col" style="width:90px;display:none">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
                            <th style="width:120px">–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</th>
                            <th style="width:50px">‚úï</th>
                        </tr>
                    </thead>
                    <tbody id="taskTableBody"></tbody>
                </table>
            </div>
        </section>

        <!-- Gantt Tab -->
        <section id="tab-gantt" class="card" style="display:none;">
            <div class="row gantt-controls">
                <button id="backToTableBtn" class="btn secondary">‚Üê –¢–∞–±–ª–∏—Ü–∞</button>
                <label class="note">
                    –ú–∞—Å—à—Ç–∞–±: 
                    <select id="zoomSelect">
                        <option value="12" selected>12 —á</option>
                        <option value="24">24 —á</option>
                        <option value="48">2 –¥–Ω</option>
                        <option value="168">–ù–µ–¥–µ–ª—è</option>
                    </select>
                </label>
                <label class="note toggle-label">
                    <input type="checkbox" id="showDependencies" checked>
                    <span>–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏</span>
                </label>
                <label class="note toggle-label">
                    <input type="checkbox" id="showCriticalPath">
                    <span>–ö—Ä–∏—Ç. –ø—É—Ç—å</span>
                </label>
            </div>
            <div class="gantt-wrap" id="ganttContainer">
                <div class="gantt" id="gantt">
                    <div class="y-labels" id="yLabels"></div>
                    <div class="timeline" id="timeline">
                        <div class="time-header" id="timeHeader"></div>
                        <svg id="depsSvg" class="deps-svg"></svg>
                        <div class="gantt-grid" id="ganttGrid"></div>
                        <div class="gantt-bars" id="ganttBars"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Broadcast Tab -->
        <section id="tab-broadcast" class="card" style="display:none;">
            <div class="broadcast-grid">
                <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ -->
                <div class="broadcast-column">
                    <h3>üë• –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ —Ä–∞—Å—Å—ã–ª–∫–∏</h3>
                    <div class="subscriber-add-form">
                        <input type="text" id="newSubscriberName" placeholder="–ò–º—è –ø–æ–¥–ø–∏—Å—á–∏–∫–∞" style="flex:1">
                        <input type="text" id="newSubscriberChatId" placeholder="Chat ID" style="flex:1">
                        <button id="addSubscriberBtn" class="btn">‚ûï</button>
                    </div>
                    <div id="subscribersList" class="subscribers-list">
                        <div class="note">–ù–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</div>
                    </div>
                </div>

                <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –†–∞—Å—Å—ã–ª–∫–∞ -->
                <div class="broadcast-column">
                    <h3>üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</h3>
                    <div class="broadcast-form">
                        <label>–¢–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏—è</label>
                        <input type="text" id="broadcastSubject" placeholder="–¢–µ–º–∞">
                        
                        <label>–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</label>
                        <textarea id="broadcastMessage" rows="6" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è..."></textarea>
                        
                        <div class="broadcast-quick-messages">
                            <span class="note">–ë—ã—Å—Ç—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:</span>
                            <button class="btn ghost quick-msg" data-msg="summary">üìä –°–≤–æ–¥–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞</button>
                            <button class="btn ghost quick-msg" data-msg="reminder">‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ</button>
                            <button class="btn ghost quick-msg" data-msg="urgent">üö® –°—Ä–æ—á–Ω–æ</button>
                        </div>
                        
                        <div class="broadcast-actions">
                            <button id="sendToAllBtn" class="btn save-btn">üì§ –†–∞–∑–æ—Å–ª–∞—Ç—å –≤—Å–µ–º</button>
                            <span id="broadcastCount" class="note">–ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: 0</span>
                        </div>
                    </div>

                    <h3 style="margin-top:24px">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞</h3>
                    <div class="setting-item">
                        <label>Bot Token</label>
                        <input type="text" id="telegramTokenBroadcast" placeholder="123456:ABC-DEF...">
                        <label>–í–∞—à Chat ID (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)</label>
                        <input type="text" id="telegramChatIdBroadcast" placeholder="-1001234567890">
                        <button id="testTelegramBroadcastBtn" class="btn secondary">üß™ –¢–µ—Å—Ç</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings Tab -->
        <section id="tab-settings" class="card" style="display:none;">
            <div class="settings-grid">
                <div>
                    <h3>üìÅ –ü—Ä–æ–µ–∫—Ç</h3>
                    <div class="setting-item">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</label>
                        <div class="row">
                            <input type="text" id="projectNameInput" placeholder="–ú–æ–π –ø—Ä–æ–µ–∫—Ç">
                            <button id="saveProjectNameBtn" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        </div>
                    </div>

                    <h3>‚öôÔ∏è –ü–æ–≤–µ–¥–µ–Ω–∏–µ</h3>
                    <div class="setting-item">
                        <label class="toggle-label" style="cursor:pointer">
                            <input type="checkbox" id="continueFromLastCheck">
                            <span>–ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–∞–±–æ—Ç—ã</span>
                        </label>
                        <div class="note" style="margin-top:8px">
                            –ù–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–π
                        </div>
                    </div>

                    <h3>üìä –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–æ–≤</h3>
                    <div class="setting-item">
                        <label class="toggle-label" style="cursor:pointer">
                            <input type="checkbox" id="showProgressCheck">
                            <span>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label class="toggle-label" style="cursor:pointer">
                            <input type="checkbox" id="showPriorityCheck">
                            <span>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</span>
                        </label>
                    </div>

                    <h3>üé® –¢–∏–ø—ã —Ä–∞–±–æ—Ç</h3>
                    <div id="typeList" class="type-list"></div>
                    <button id="addTypeBtn" class="btn ghost">+ –¢–∏–ø</button>
                </div>

                <div>
                    <h3>üì§ –≠–∫—Å–ø–æ—Ä—Ç / –ò–º–ø–æ—Ä—Ç</h3>
                    <div class="setting-item">
                        <input type="file" id="importJsonInput" accept=".json" style="display:none">
                        <button id="importJsonBtn" class="btn secondary">üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å JSON</button>
                        <button id="exportJsonBtn" class="btn secondary">üì§ –°–∫–∞—á–∞—Ç—å JSON</button>
                    </div>

                    <h3>üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è Telegram</h3>
                    <div class="setting-item">
                        <label>Bot Token</label>
                        <input type="text" id="telegramToken" placeholder="123456:ABC-DEF...">
                        <label>Chat ID</label>
                        <input type="text" id="telegramChatId" placeholder="-1001234567890">
                        <button id="testTelegramBtn" class="btn secondary">–¢–µ—Å—Ç</button>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="share-modal">
        <div class="share-modal-content">
            <h2>üîó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º</h2>
            <p class="note">–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è</p>
            <div class="share-link-container">
                <input type="text" id="shareLinkInput" class="share-link-input" readonly>
                <button id="copyShareLinkBtn" class="share-copy-btn">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            <button id="closeShareModalBtn" class="btn secondary" style="margin-top:16px">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- Shared View -->
    <div id="sharedView" class="shared-view">
        <div class="shared-header">
            <div>
                <h1 id="sharedTitle">üìä –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</h1>
                <p id="sharedDate"></p>
            </div>
            <div>
                <button id="toggleSharedStyleBtn" class="btn secondary">üé® –°—Ç–∏–ª—å</button>
                <button id="downloadSharedBtn" class="btn">üì• –°–∫–∞—á–∞—Ç—å</button>
            </div>
        </div>
        <div class="shared-table-container">
            <table class="shared-table">
                <thead>
                    <tr>
                        <th>üìÖ –î–∞—Ç–∞</th>
                        <th>‚è∞ –í—Ä–µ–º—è</th>
                        <th>üì¶ –¢–∏–ø</th>
                        <th>üìù –†–∞–±–æ—Ç–∞</th>
                        <th>üë§ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</th>
                        <th>üìä –ü—Ä–æ–≥—Ä–µ—Å—Å</th>
                    </tr>
                </thead>
                <tbody id="sharedTableBody"></tbody>
            </table>
        </div>
    </div>

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- App Modules -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
